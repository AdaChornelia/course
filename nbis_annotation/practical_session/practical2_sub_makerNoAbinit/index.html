<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   
    <link rel="shortcut icon" href="../../../img/favicon.ico">

    <title></title>

    <link href="../../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../../css/base.css" rel="stylesheet">
    <link href="../../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">


    <link href="../../../css/admonition.css" rel="stylesheet">


    <link href="../../../css/navbar.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../../..">Bioinformatics course</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 1 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../proteins/">Proteins</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 2 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../unix/">Unix</a>
</li>

                        
                            
<li >
    <a href="../../../cloud/">Cloud Computing</a>
</li>

                        
                            
<li >
    <a href="../../../software/">Installing Software</a>
</li>

                        
                            
<li >
    <a href="../../../git/">Git</a>
</li>

                        
                            
<li >
    <a href="../../../blast/">Command-line Blast</a>
</li>

                        
                            
<li >
    <a href="../../../project_organisation/">Project Organisation</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 3 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../seq_tech/">Sequencing Technologies</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/qc/">Quality Control</a>
</li>

                        
                            
<li >
    <a href="../../../assembly_challenge/">Assembly Challenge</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/assembly/">De-novo Genome Assembly</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/annotation/">Genome Annotation</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/pan_genome/">Pan-genome Analysis</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/nanopore/">Nanopore Sequencing</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 4 <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../../tutorials/docs/rna/">RNA Sequencing</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/16S/">Metabarcoding</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/meta_assembly/">Metagenome assembly</a>
</li>

                        
                            
<li >
    <a href="../../../tutorials/docs/wms/">Comparative metagenomics</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Week 5 - Eukaryotic Annotation <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../schedule/">Schedule</a>
</li>

                        
                            
<li >
    <a href="../practical1/">Practical 1</a>
</li>

                        
                            
<li >
    <a href="../practical2/">Practical 2</a>
</li>

                        
                            
<li >
    <a href="../practical3_manualCuration/">Practical 3</a>
</li>

                        
                            
<li >
    <a href="../practical4_funcAnnotInterp/">Practical 4</a>
</li>

                        
                            
  <li class="dropdown-submenu">
    <a tabindex="-1" href="">Extras</a>
    <ul class="dropdown-menu">
        
            
<li >
    <a href="../UsingWebApollo/">WebApollo</a>
</li>

        
            
<li >
    <a href="../practical2_sub_gatherEvidence/">Protein, EST and RNA-seq data</a>
</li>

        
            
<li >
    <a href="../practical2_sub_transcriptome/">Assembling transcripts</a>
</li>

        
            
<li class="active">
    <a href="./">Evidence Based Annotation</a>
</li>

        
            
<li >
    <a href="../practical2_sub_makerAbinit/">Abinitio Annotation</a>
</li>

        
            
<li >
    <a href="../practical2_sub_makerCompareAnnot/">Comparing Annotations</a>
</li>

        
            
<li >
    <a href="../practical2_supl_maker/">Configuring Maker (I)</a>
</li>

        
            
<li >
    <a href="../practical2_supl3_maker/">Configuring Maker (I)</a>
</li>

        
            
<li >
    <a href="../practical2_supl2_maker/">Inspecting Maker output</a>
</li>

        
    </ul>
  </li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../practical2_sub_transcriptome/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../practical2_sub_makerAbinit/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#making-an-evidence-based-annotation-with-maker">Making an evidence based annotation with MAKER</a></li>
            <li class="second-level"><a href="#overview">Overview</a></li>
                
            <li class="second-level"><a href="#prepare-the-input-data">Prepare the input data</a></li>
                
            <li class="second-level"><a href="#run-maker">Run Maker</a></li>
                
            <li class="second-level"><a href="#inspect-the-output-optional">Inspect the output (optional)</a></li>
                
            <li class="second-level"><a href="#compile-the-output">Compile the output</a></li>
                
            <li class="second-level"><a href="#inspect-the-gene-models">Inspect the gene models</a></li>
                
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="making-an-evidence-based-annotation-with-maker">Making an evidence based annotation with MAKER</h1>
<h2 id="overview">Overview</h2>
<p>The first run of Maker will be done without ab-initio predictions. What are your expectations for the resulting gene build? In essence, we are attempting a purely evidence-based annotation, where the best protein- and EST-alignments are chosen to build the most likely gene models. The purpose of an evidence-based annotation is simple. Basically, you may try to annotate an organism where no usable ab-initio model is available. The evidence-based annotation can then be used to create a set of genes on which a new model could be trained on (using e.g. Snap or Augustus). Selection of genes for training can be based on the annotation edit distance (AED score), which says something about how great the distance between a gene model and the evidence alignments is. A score of 0.0 would essentially say that the final model is in perfect agreement with the evidence.</p>
<p>Let's do this step-by-step:</p>
<h2 id="prepare-the-input-data">Prepare the input data</h2>
<p>Link the raw computes you want to use into your folder. The files you will need are:</p>
<ul>
<li>the gff file of the pre-computed repeats (coordinates of repeatmasked regions)</li>
</ul>
<pre><code>ln -s ~/annotation_course/data/raw_computes/repeatmasker.chr4.gff
ln -s ~/annotation_course/data/raw_computes/repeatrunner.chr4.gff
</code></pre>

<p>In addition, you will also need the genome sequence.</p>
<pre><code>ln -s ~/annotation_course/data/genome/4.fa
</code></pre>

<p>Then you will also need EST and protein fasta file:  </p>
<pre><code>ln -s ~/annotation_course/data/evidence/est.chr4.fa 
ln -s ~/annotation_course/data/evidence/proteins.chr4.fa
</code></pre>

<p>To finish you will could use a transcriptome assembly (This one has been made using Stringtie):</p>
<pre><code>ln -s ~/annotation_course/data/RNAseq/stringtie/stringtie2genome.chr4.gff
</code></pre>

<p>/!\ Always check that the gff files you provides as protein or EST contains   match / match_part (gff alignment type ) feature types rather than genes/transcripts (gff annotation type) otherwise MAKER will not use the contained data properly. Here we have to fix the stringtie gff file.</p>
<pre><code>gff3_sp_alignment_output_style.pl --gff stringtie2genome.chr4.gff -o stringtie2genome.chr4.ok.gff
</code></pre>

<p>You should now have 1 repeat file, 1 EST file, 1 protein file, 1 transcript file, and the genome sequence in the working directory. </p>
<p>For Maker to use this information, we need create the three config files, typing this command:</p>
<pre><code>maker -CTL
</code></pre>

<p>You can leave the two files controlling external software behaviors untouched. In the actual maker options file called <strong>maker_opts.ctl</strong>, we need to provide:</p>
<ul>
<li>name of the genome sequence (genome=)</li>
<li>name of the 'EST' file in fasta format  (est=)</li>
<li>name of the 'Transcript' file in gff format (est_gff=)</li>
<li>name of the 'Protein' set file(s) (protein=)</li>
<li>name of the repeatmasker and repeatrunner files (rm_gff=) </li>
</ul>
<p>You can list multiple files in one field by separating their names by a <strong>comma</strong> ','.</p>
<p>This time, we do not specify a reference species to be used by augustus, which will disable ab-initio gene finding. Instead we set:</p>
<p><i>protein2genome=1</i><br />
  <i>est2genome=1</i></p>
<p>This will enable gene building directly from the evidence alignments.</p>
<p>To edit the <strong>maker_opts.ctl</strong> file you can use the nano text editor:</p>
<pre><code>nano maker_opts.ctl
</code></pre>

<p>Before running MAKER you can check you have modified the maker_opts.ctl file properly <a href="../practical2_supl_maker/">here</a>.<br/>
/!\ Be sure to have deactivated the parameters <strong>model_org= #</strong> and <strong>repeat_protein= #</strong> to avoid the heavy work of repeatmasker.</p>
<h2 id="run-maker">Run Maker</h2>
<p>If your maker_opts.ctl is configured correctly, you should be able to run maker:</p>
<pre><code>mpiexec -n 8 maker
</code></pre>

<p>This will start Maker on 8 cores, if everything is configured correctly.
This will take a little while and process a lot of output to the screen. Luckily, much of the heavy work - such as repeat masking - are already done, so the total running time is quite manageable, even on a small number of cores.</p>
<h2 id="inspect-the-output-optional">Inspect the output (optional)</h2>
<p><a href="../practical2_supl2_maker/">Here you can find details about the MAKER output.</a></p>
<h2 id="compile-the-output">Compile the output</h2>
<p>Once Maker is finished, compile the annotation:</p>
<pre><code>maker_merge_outputs_from_datastore.pl --output maker_no_abinitio
</code></pre>

<p>We have specified a name for the output directory since we will be creating more than one annotation and need to be able to tell them apart.  </p>
<p>This should create a "maker_no_abinitio" directory containing a maker annotation file together with the matching protein predictions file and a sub-directory containing different annotation files including the <strong>maker.gff</strong> which is the result to keep from this analysis. </p>
<p>=&gt; You could sym-link the maker.gff file to another folder called e.g. dmel_results, so everything is in the same place in the end. Just make sure to call the link something other than maker.gff, since any maker output will be called that.</p>
<h2 id="inspect-the-gene-models">Inspect the gene models</h2>
<p>To get some statistics of your annotation you could launch :</p>
<pre><code>gff3_sp_statistics.pl --gff maker_no_abinitio/annotationByType/maker.gff
</code></pre>

<p>We could now also visualise the annotation in the Webapollo genome browser.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../../js/jquery-1.10.2.min.js"></script>
    <script src="../../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../../..';
    </script>
    <script data-main="../../../mkdocs/js/search.js" src="../../../mkdocs/js/require.js"></script>
    <script src="../../../js/base.js"></script>
    <script src="../../../search/require.js"></script>
    <script src="../../../search/search.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
